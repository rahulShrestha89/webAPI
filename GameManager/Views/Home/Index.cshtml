<div class="row">
    <div class="well-lg col-lg-offset-0">
        <h1>API DASHBOARD</h1>

        <div class="pull-right">
            <div class="dropdown right">
                <select id="preset-roles">
                    <option value="">Select Preset Roles</option>
                    <option value="admin">Admin</option>
                    <option value="employee">Employee</option>
                    <option value="customer">Customer</option>
                </select>
            </div>
        </div>
    </div>
</div>
<br />

<div class="alert alert-danger alertfade" id="error-failed" style="display:none;">

</div>

<div class="alert alert-success alertfade" id="success-good" style="display:none;">

</div>

<div class="row">
    <div class="col-lg-offset-0">
        <div class="tabbed-panes">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="mytab">
                <li class="active">
                    <a href="#apikey" data-toggle="tab" class="apikey">
                        API KEY
                    </a>
                </li>
                <li>
                    <a href="#users" data-toggle="tab" class="users">
                        USERS
                    </a>
                </li>
                <li>
                    <a href="#games" data-toggle="tab" class="games">
                        GAMES
                    </a>
                </li>
                <li>
                    <a href="#carts" data-toggle="tab" class="carts">
                        CARTS
                    </a>
                </li>
                <li>
                    <a href="#sales" data-toggle="tab" class="sales">
                        SALES
                    </a>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">
                <div class="tab-pane fade in active" id="apikey">
                    <h3>Api Key Generation</h3>
                    <br />
                    <form class="navbar-form" role="getapikey" id="get-api-key">
                        <div class="form-group">
                            <label>Username : </label>
                            <input type="text" class="form-control" id="username" placeholder="UserName">
                        </div>
                        <br /><br />
                        <div class="form-group">
                            <label>Password : </label>
                            <input type="password" id="password" class="form-control">
                        </div>
                        <br /><br />
                        <a id="get-api-button" class="btn btn-success">Get API Key</a>
                    </form>

                </div>

                <div class="tab-pane fade" id="users">
                    <h3>USERS</h3>
                    <br />
                    <div class="col-lg-3">
                        <p>Get All Users</p>
                        <a id="get-all-users" class="btn btn-success">Get All Users</a>
                        <br /><br />
                    </div>

                    <div class="col-lg-5">
                        <div class="form-group">
                            <label>User by Id : </label>
                            <input type="text" id="user-by-id" class="form-control">
                        </div>
                        <a id="get-user-id" class="btn btn-success">Get User by Id</a>
                        <br />
                    </div>
                </div>

                <div class="tab-pane fade" id="games">
                    <div class="col-lg-6">
                        <h3>GAMES</h3>
                        <br />
                        <a id="get-all-games" class="btn btn-success">Get All Games</a>
                        <br /><br />

                        <div class="form-group">
                            <label>Game by Id : </label>
                            <input type="text" id="game-by-id" class="form-control">
                        </div>
                        <a id="get-game-id" class="btn btn-success">Get Game by Id</a>
                        <br /><br />

                        <div class="form-group">
                            <label>Games by Genre : </label>
                            <input type="text" id="games-by-genre" class="form-control">
                        </div>
                        <a id="get-games-genre" class="btn btn-success">Get Games by Genre</a>
                        <br /><br />
                    </div>

                    <div class="col-lg-6">
                        <div class="form-group">
                            <h3>POST GAME</h3><br />
                            <form>
                                <label>Name : </label>
                                <input type="text" id="games-name" class="form-control"><br />
                                <label>Release Date : </label>
                                <input type="text" id="games-releasedate" class="datepicker form-control"><br />
                                <label>Price : </label>
                                <input type="text" id="games-price" class="form-control"><br />
                                <label>Inventory Count : </label>
                                <input type="text" id="games-inventorycount" class="form-control"><br />
                                <label>Genre : </label>
                                <input type="text" id="games-genre" class="form-control"><br />
                                <label>Tags : </label>
                                <input type="text" id="games-tag" class="form-control">
                            </form>
                            <br /><br />
                            <a id="post-game" class="btn btn-success">POST GAME</a>
                        </div>
                    </div>
                    <br /><br />
                </div>

                <div class="tab-pane fade" id="carts">
                    <h3>CARTS</h3>
                    <div class="col-lg-5">
                        <div class="form-group">
                            <label>Game to add to Cart : </label>
                            <input type="text" id="cart-by-game-id" class="form-control">
                        </div>
                        <a id="add-to-cart" class="btn btn-success">Add to cart</a>
                        <br /><br />
                    </div>

                    <div class="col-lg-4">
                        <h3>View Cart</h3>
                        <a id="view-cart" class="btn btn-success">View Cart</a>
                        <br /><br />
                    </div>
                </div>

                <div class="tab-pane fade" id="sales">
                    <h3>SALES</h3>
                    <div class="col-lg-5">
                        <div class="form-group">
                            <label>Cart ID to Checkout : </label>
                            <input type="text" id="cart-id-checkout" class="form-control">
                        </div>
                        <a id="process-cart" class="btn btn-success">Process Cart</a>
                        <br /><br />
                    </div>

                    <div class="col-lg-4">
                        <h3>View Sales</h3>
                        <a id="view-all-sales" class="btn btn-success">View All Sales</a><br />
                        <br /><br />

                        <label>Employee ID:</label>
                        <input type="text" id="employee-name" class="form-control"><br />
                        <a id="view-sales-employee" class="btn btn-success">View Sales by Employee</a>
                        <br /><br />
                    </div>

                </div>
            </div><!-- /Tab-content -->

            <p>
        </div>
    </div>
</div>
<br /><br />
<div class="row">
    <div class="col-lg-offset-0">
        
        <div class="results-section">

        </div>
    </div>
</div>

@section scripts{
    <script>

        $('#mytab a').click(function () {
            $('#success-good').hide();
            $('#success-good').html("");
            $('#error-field').html("");
            $('#error-field').hide();
            $('.results-section').html("");
        });

        //Get Api Key
        $('#get-api-button').on("click", function () {
            var email = $('#username').val();
            var password = $('#password').val();
            var active = $('#preset-roles').val();

            if (email.length > 0 && password.length > 0) {
                getApiKey(email, password, active);
            }
        });

        $(".alertfade").fadeOut(5000);

        //Get All Users
        $('#get-all-users').on("click", function () {
            var active = $('#preset-roles').val();
            var mode = 0;
            if (active.length > 0) {
                get_users(mode, active);
            }
        });

        //Get Specific User
        $('#get-user-id').on("click", function () {
            var active = $('#preset-roles').val();
            var mode = $('#user-by-id').val();
            if (active.length > 0 && mode > 0) {
                get_users(mode, active);
            }
        });

        //Get All Games
        $('#get-all-games').on("click", function () {
            var active = $('#preset-roles').val();
            var mode = 0;
            get_games(mode, mode, active);
        });

        //Get Specific Game
        $('#get-game-id').on("click", function () {
            var active = $('#preset-roles').val();
            var mode = 1;
            var id = $('#game-by-id').val();
            if (id > 0) {
                get_games(mode, id, active);
            }
        });

        //Get Game by Genre
        $('#get-games-genre').on("click", function () {
            var active = $('#preset-roles').val();
            var mode = 2;
            var id = $('#games-by-genre').val();
            if (id > 0) {
                get_games(mode, id, active);
            }
        });

        //Post Game
        $('#post-game').on("click", function () {
            var active = $('#preset-roles').val();
            var games = new Object;

            games['Name'] = $('#games-name').val();
            games['ReleaseDate'] = $('#games-releasedate').val();
            games['Price'] = $('#games-price').val();
            games['InventoryCount'] = $('#games-inventorycount').val();
            games['Genres'] = $('#games-genre').val();
            games['Tags'] = $('#games-tag').val();

            if (active.length > 0) {
                post_game(active, games);
            }
        });

        //Add to Cart
        $('#add-to-cart').on("click", function () {
            var active = $('#preset-roles').val();
            var game = $('#cart-by-game-id').val();
            var games = game.split(" ,");
            if (active.length > 0) {
                if (games.length > 0) {
                    add_to_cart(active, game);
                }
                else {
                    add_to_cart(active, game);
                }
            }
            else {
                alert("You need to be authorized.");
            }
        });

        //View Cart
        $('#view-cart').on("click", function () {
            var active = $('#preset-roles').val();
            if (active.length > 0) {
                view_cart(active);
            }
            else {
                alert("You need to be authorized.");
            }
        });


        //View All Sales
        $('#view-all-sales').on("click", function () {
            var active = $('#preset-roles').val();
            if (active.length > 0) {
                view_all_sales(active);
            }
            else {
                alert("You need to be authorized.");
            }
        });


        //View Sales by Employee
        $('#view-sales-employee').on("click", function () {
            var active = $('#preset-roles').val();
            var employee = $('#employee-name').val();

            if (active.length > 0) {
                view_sales(active, employee);
            }
            else {
                alert("You need to be authorized.");
            }
        });

        //Process Cart
        $('#process-cart').on("click", function () {
            var active = $('#preset-roles').val();
            var cart_id = $('#cart-id-checkout').val();

            if (active.length > 0) {
                process_cart(active, cart_id);
            }
            else {
                alert("You need to be authorized.");
            }
        });

        function process_cart(active, cart_id) {
            var active_header = get_headers();

            $.ajax({
                url: '/api/Cart/process/',
                type: 'GET',
                data: { 'id': cart_id },
                headers: {
                    'xcmps383authenticationid': active_header[0],
                    'xcmps383authenticationkey': active_header[1],
                },
                success: function (data) {
                    $('#success-good').html("SALES PROCESSED...");
                    $('#success-good').show();
                },
                error: function (data) {
                    $('#error-failed').html(data);
                    $('#error-failed').show();
                },
            });
        }

        function view_all_sales(active) {
            var active_header = get_headers();

            $.ajax({
                url: '/api/Sales/',
                type: 'GET',
                headers: {
                    'xcmps383authenticationid': active_header[0],
                    'xcmps383authenticationkey': active_header[1],
                },
                success: function (data) {
                    $('#success-good').html("SALES LIST GENERATED...");
                    $('.results-section').html(show_all_sales(data));
                    $('#success-good').show();
                },
                error: function (data) {
                    $('#error-failed').html(data);
                    $('#error-failed').show();
                },
            });
        }

        function view_sales(active, employee) {
            var active_header = get_headers();

            $.ajax({
                url: '/api/Sales/',
                data: { 'name': employee },
                type: 'GET',
                headers: {
                    'xcmps383authenticationid': active_header[0],
                    'xcmps383authenticationkey': active_header[1],
                },
                success: function (data) {
                    $('#success-good').html("SALES LIST GENERATED...");
                    $('.results-section').html(show_sales_emp(data));
                    $('#success-good').show();
                },
                error: function (data) {
                    $('#error-failed').html(data);
                    $('#error-failed').show();
                },
            });
        }

        function show_all_sales(sales_data) {
            var table_html = "";
            console.log(sales_data);
            if (sales_data.length > 0) {
                table_html = "<table class='table table-striped table-bordered'>"
                + "<thead>"
                + "<tr>"
                + "<th>ID</th>"
                + "<th>Cart ID</th>"
                + "<th>Date</th>"
                + "<th>Games</th>"
                + "<th>Sales Processed By</th>"
                + "<th>Total Amount</th>"
                + "</tr>"
                + "</thead>";
                + "<tbody>";

                $.each(sales_data, function (index, obj) {
                    table_html += "<tr>";
                    table_html += "<td>" + obj.Id + "</td>";
                    table_html += "<td>" + obj.CartID + "</td>";
                    table_html += "<td>" + obj.Date + "</td>";
                    table_html += "<td>" + JSON.stringify(obj.Games) + "</td>";
                    table_html += "<td>" + obj.SaleProcessedBy + "</td>";
                    table_html += "<td>" + obj.TotalAmount + "</td>";
                });
                table_html += "</tbody></table>";
            }
            return table_html;
        }

        function show_sales_emp(sales_data) {
            var table_html = "";
            console.log(sales_data);
            if (sales_data.length > 0) {
                table_html = "<table class='table table-striped table-bordered'>"
                + "<thead>"
                + "<tr>"
                + "<th>ID</th>"
                + "<th>Cart ID</th>"
                + "<th>Date</th>"
                + "<th>Sales Processed By</th>"
                + "<th>Total Amount</th>"
                + "</tr>"
                + "</thead>";
                + "<tbody>";

                $.each(sales_data, function (index, obj) {
                    table_html += "<tr>";
                    table_html += "<td>" + obj.Id + "</td>";
                    table_html += "<td>" + obj.CartId + "</td>";
                    table_html += "<td>" + obj.Date + "</td>";
                    table_html += "<td>" + obj.EmployeeId + "</td>";
                    table_html += "<td>" + obj.TotalAmount + "</td>";
                });
                table_html += "</tbody></table>";
            }
            return table_html;
        }

        function add_to_cart(active, game) {
            var active_header = get_headers();
            var games = game.split(",");
            if (games.length > 1) {
                var cart_games = new Object;
                cart_games['games'] = game;
                //json
                $.ajax({
                    url: '/api/Cart/',
                    data: cart_games,
                    type: 'POST',
                    dataType: 'application/json',
                    headers: {
                        'xcmps383authenticationid': active_header[0],
                        'xcmps383authenticationkey': active_header[1],
                    },
                    success: function (data) {
                        $('#success-good').html("SUCCESS : Games added to cart.");
                        $('#success-good').show();
                    },
                    error: function (data) {
                        $('#error-failed').html(data);
                        $('#error-failed').show();
                    },
                });
            }
            else {
                $.ajax({
                    url: '/api/Cart/AddtoCart',
                    data: { 'id': game },
                    type: 'POST',
                    headers: {
                        'xcmps383authenticationid': active_header[0],
                        'xcmps383authenticationkey': active_header[1],
                    },
                    success: function (data) {
                        $('#success-good').html("SUCCESS : Game added to cart.");
                        $('#error-failed').hide();
                        $('#success-good').show();
                    },
                    error: function (data) {
                        $('#error-failed').html(data);
                        $('#success-good').hide();
                        $('#error-failed').show();
                    },
                });
            }

        }

        function view_cart(active) {
            var active_header = get_headers();

            $.ajax({
                url: '/api/Cart/',
                type: 'GET',
                headers: {
                    'xcmps383authenticationid': active_header[0],
                    'xcmps383authenticationkey': active_header[1],
                },
                success: function (data) {
                    $('#success-good').html("CART LIST GENERATED...");
                    $('.results-section').html(show_cart(data));
                    $('#success-good').show();
                },
                error: function (data) {
                    $('#error-failed').html(data);
                    $('#error-failed').show();
                },
            });

        }

        function post_game(active, games) {
            var active_header = get_headers();

            $.ajax({
                url: '/api/Games',
                data: games,
                type: 'POST',
                dataType: 'application/json',
                headers: {
                    'xcmps383authenticationid': active_header[0],
                    'xcmps383authenticationkey': active_header[1],
                },
                success: function (data) {
                    $('#success-good').html("SUCCESS : Game Posted.");
                    $('#success-good').show();
                },
                error: function (data) {
                    $('#error-failed').html(data);
                    $('#error-failed').show();
                },
            });
        }

        function get_headers() {
            var active = $('#preset-roles').val();

            if (active == "admin") {
                var admin = ["sa@383.com", fetch_apikey("sa@383.com", "password")];
                return admin;
            }
            else if (active == "employee") {
                var employee = ["emp@383.com", fetch_apikey("emp@383.com", "password")];
                return employee;
            }
            else if (active == "customer") {
                var customer = ["cust@383.com", fetch_apikey("cust@383.com", "password")];
                return customer;
            }
            else {
                return 0;
            }
        }

        function getApiKey(email, password, active) {
            $.ajax({
                url: '/api/ApiKey',
                data: { email: email, password: password },
                type: 'GET',
                success: function (data) {
                    $('#success-good').html("API KEY GENERATED : " + data);
                    $('#success-good').show();
                },
                error: function (data) {
                    $('#error-failed').html(data);
                    $('#error-failed').show();
                },
            });
        }

        function fetch_apikey(email, password) {
            var apikey = "";
            $.ajax({
                url: '/api/ApiKey',
                data: { email: email, password: password },
                type: 'GET',
                success: function (data) {
                    apikey = data;
                }
            });
            return apikey;
        }

        function get_users(mode, active) {
            var active_header = get_headers();
            console.log(active_header);

            if (mode > 0) {
                $.ajax({
                    url: '/api/User/',
                    data: { "id": mode },
                    type: 'GET',
                    headers: {
                        'xcmps383authenticationid': active_header[0],
                        'xcmps383authenticationkey': active_header[1],
                    },
                    success: function (data) {
                        $('#success-good').html("LIST OF USERS FETCHED : ");
                        $('.results-section').html(show_user(data));
                        $('#success-good').show();
                    },
                    error: function (data) {
                        $('#error-failed').html(data);
                        $('#error-failed').show();
                    },
                });
            }
            else {
                $.ajax({
                    url: '/api/User',
                    type: 'GET',
                    headers: {
                        'xcmps383authenticationid': active_header[0],
                        'xcmps383authenticationkey': active_header[1],
                    },
                    success: function (data) {
                        $('#success-good').html("LIST OF USERS FETCHED : ");
                        $('.results-section').html(show_users(data));
                        $('#success-good').show();
                    },
                    error: function (data) {
                        $('#error-failed').html(data);
                        $('#error-failed').show();
                    },
                });
            }
        }

        function show_users(users_data) {
            var table_html = "";
            if (users_data.length > 0) {
                table_html = "<table class='table table-striped table-bordered' id='users_table'>"
                + "<thead>"
                + "<tr>"
                + "<th>ID</th>"
                + "<th>Email</th>"
                + "<th>Role</th>"
                + "</tr>"
                + "</thead>";
                + "<tbody>";

                $.each(users_data, function (index, obj) {
                    table_html += "<tr>";
                    table_html += "<td>" + obj.Id + "</td>";
                    table_html += "<td>" + obj.Email + "</td>";
                    table_html += "<td>" + obj.Role + "</td>";
                });
                table_html += "</tbody></table>";
            }
            return table_html;
        }

        function show_user(users_data) {
            var table_html = "";

            table_html = "<table class='table table-striped table-bordered' id='users_table'>"
            + "<thead>"
            + "<tr>"
            + "<th>ID</th>"
            + "<th>Email</th>"
            + "<th>Role</th>"
            + "</tr>"
            + "</thead>";
            + "<tbody>";


            table_html += "<tr>";
            table_html += "<td>" + users_data.Id + "</td>";
            table_html += "<td>" + users_data.Email + "</td>";
            table_html += "<td>" + users_data.Role + "</td>";

            table_html += "</tbody></table>";

            return table_html;
        }


        function show_cart(cart_data) {
            var table_html = "";
            table_html = "<h3><b>Cart Details </b></h3><br />Customer ID : " + cart_data[0].CustomerId + "<br /><br /> Total Price : " + cart_data[0].TotalPrice
            + "<br /><table class='table table-striped table-bordered'>"
            + "<thead>"
            + "<tr>"
            + "<th>Game ID</th>"
            + "<th>Name</th>"
            + "<th>ReleaseDate</th>"
            + "<th>Price</th>"
            + "<th>Inventory</th>"
            + "</tr>"
            + "</thead>";
            + "<tbody>";

            $.each(cart_data[0].GamesInCart, function (index, obj) {
                table_html += "<tr>";
                table_html += "<td>" + obj.Id + "</td>";
                table_html += "<td>" + obj.Name + "</td>";
                table_html += "<td>" + obj.ReleaseDate + "</td>";
                table_html += "<td>" + obj.Price + "</td>";
                table_html += "<td>" + obj.InventoryCount + "</td>";
            });


            table_html += "</tbody></table>";

            return table_html;
        }

        function get_games(mode, id, active) {
            var active_header = get_headers();

            if (mode == 0) {
                $.ajax({
                    url: '/api/Games/',
                    type: 'GET',
                    headers: {
                        'xcmps383authenticationid': active_header[0],
                        'xcmps383authenticationkey': active_header[1],
                    },
                    success: function (data) {
                        $('#success-good').html("LIST OF GAMES FETCHED...");
                        $('.results-section').html(show_games(data));
                        $('#success-good').show();
                    },
                    error: function (data) {
                        $('#error-failed').html(data);
                        $('#error-failed').show();
                    },
                });
            }
            else if (mode == 1) {
                $.ajax({
                    url: '/api/Games',
                    data: { 'game': id },
                    type: 'GET',
                    headers: {
                        'xcmps383authenticationid': active_header[0],
                        'xcmps383authenticationkey': active_header[1],
                    },
                    success: function (data) {
                        $('#success-good').html("LIST OF GAMES FETCHED...");
                        $('.results-section').html(show_game(data));
                        $('#success-good').show();
                    },
                    error: function (data) {
                        $('#error-failed').html(data);
                        $('#error-failed').show();
                    },
                });
            }
            else if (mode == 2) {
                $.ajax({
                    url: '/api/Games',
                    data: { 'genre': id },
                    type: 'GET',
                    headers: {
                        'xcmps383authenticationid': active_header[0],
                        'xcmps383authenticationkey': active_header[1],
                    },
                    success: function (data) {
                        $('#success-good').html("LIST OF GAMES FETCHED...");
                        $('.results-section').html(show_games(data));
                        $('#success-good').show();
                    },
                    error: function (data) {
                        $('#error-failed').html(data);
                        $('#error-failed').show();
                    },
                });
            }
        }

        function show_games(games_data) {
            var table_html = "";
            if (games_data.length > 0) {
                table_html = "<table class='table table-striped table-bordered' id='games_table'>"
                + "<thead>"
                + "<tr>"
                + "<th>ID</th>"
                + "<th>Name</th>"
                + "<th>Release Date</th>"
                + "<th>Price</th>"
                + "<th>Inventory Count</th>"
                + "<th>Genres</th>"
                + "<th>Tags</th>"
                + "</tr>"
                + "</thead>";
                + "<tbody>";

                $.each(games_data, function (index, obj) {
                    table_html += "<tr>";
                    table_html += "<td>" + obj.Id + "</td>";
                    table_html += "<td>" + obj.Name + "</td>";
                    table_html += "<td>" + obj.ReleaseDate + "</td>";
                    table_html += "<td>" + obj.Price + "</td>";
                    table_html += "<td>" + obj.InventoryCount + "</td>";
                    table_html += "<td>" + obj.Genres + "</td>";
                    table_html += "<td>" + obj.Tags + "</td>";

                });
                table_html += "</tbody></table>";
            }
            return table_html;
        }

        function show_game(games_data) {
            var table_html = "";

            table_html = "<table class='table table-striped table-bordered' id='games_table'>"
            + "<thead>"
            + "<tr>"
            + "<th>ID</th>"
            + "<th>Name</th>"
            + "<th>Release Date</th>"
            + "<th>Price</th>"
            + "<th>Inventory Count</th>"
            + "</tr>"
            + "</thead>";
            + "<tbody>";

            table_html += "<tr>";
            table_html += "<td>" + games_data.Id + "</td>";
            table_html += "<td>" + games_data.Name + "</td>";
            table_html += "<td>" + games_data.ReleaseDate + "</td>";
            table_html += "<td>" + games_data.Price + "</td>";
            table_html += "<td>" + games_data.InventoryCount + "</td>";

            return table_html;
        }
    </script>
}